module fnet_EMM

! a = 0.00014203
! b = 0.075691

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/-0.328999575330,0.083714836082,-0.004936954688,0.313088250017,0.477210142764,0.060100728431,-0.045050119577,0.517405857487,0.293608790206,-0.037655796043,0.030941411416,-0.111238616638 &
            ,-0.247572016354,-0.030801097041,0.057432673344,-0.280831892131,-0.198541626921,0.079347518747,0.008544887510,-0.288545451332,-0.332794684639,0.007383303539,-0.032340501071,-0.342343120887 &
            ,0.099471499814,0.348552524776,-0.031114797971,0.209538647653,0.261209548586,0.026254963715,0.281499880664,0.376047058970,0.459733814122,-0.239052296445,-0.012097506445,0.094923309528 &
            ,-0.160312782251,-0.015252968291,-0.225688925204,-0.155812474774,0.150084830288,0.280995551388,0.086206562875,-0.150964427945,-0.183580514562,0.077929361718,-0.199154022201,-0.047383476846 &
            ,-0.334955795673,-0.137392578089,-0.215367189778,0.264621358945,0.195234303844,-0.068547628499,0.287770966978,0.137723581579,-0.306020574320,0.009031979850,-0.029363954108,-0.294935019064 &
            ,-0.192417585096,0.094483135970,-0.582407970752,-0.104437385375,0.249193521477,0.758960471032,0.010645666711,-0.501409812786,-0.964454449731,0.153197573905,-0.200214239215,-0.475588877885 &
            ,0.480877648288,-0.536011379852,0.074564048030,0.266547875556,0.189956600748,-0.005171144467,-0.178862379846,0.276577375747,-0.003996364393,-0.104346399406,-0.054213293140,-0.173357344151 &
            ,-0.028090602031,-0.090675254107,0.346060093022,-0.165511592213,0.007764032963,0.117850111763,-0.133275663072,0.115002656647,0.306481958445,0.010458860833,-0.063649078582,0.366062422706 &
            ,-0.320601145508,0.130305057047,-0.248972518428,-0.093323073907,0.099385270295,-0.056320428674,0.288484428416,0.065308074935,-0.247386475110,0.100738678376,-0.039143211040,0.251221431202 &
            ,-0.108732795807,0.024399233286,-0.050152577119,-0.287715906178,0.011480174184,-0.087179923652,-0.007063512159,0.245596644687,0.084800895388,-0.021545663045,0.111080276174,-0.013185307890 &
            ,0.307248557718,0.141785773222,-0.236377984165,0.436535318225,0.382931656524,0.025071657699,-0.124861332256,0.420790750323,0.397439078805,-0.153128840342,0.077246743830,0.156468001847 &
            ,0.275826664753,0.010038772633,-0.063799140841,0.401320342105,-0.315194404122,-0.156526629923,0.046464733502,-0.337580539477,-0.234038664808,-0.018447151686,-0.021880384269,-0.104031590258 &
            ,-0.197095952087,-0.028680124412,0.960998499618,-0.304766408878,0.390837555936,0.246571249342,-0.698441252332,0.682429302703,0.291718249951,-0.616182742730,-0.362824151185,0.756445132761 &
            ,-0.464701606077,-0.282154503185,0.752984823729,-0.931710947109,-1.264208471806,0.046153808301,-0.324346029664,-0.842156359033,0.235658292779,-0.065151885254,1.035265402912,1.328327628658 &
            ,-1.297406664671,0.520236196066,-0.428644843423,-0.476101503241,0.494196832277,0.066585293758,-0.357393612475,0.244768964940,-0.009920351456,0.040652070406,-0.990112228468,0.452466444155 &
            ,0.715175583635,-0.041802581510,-0.039028758118,1.859085925428,-0.224456938747,-0.014981497925,-0.417509722616,0.918370564073,1.411613037342,-0.232987403574,1.485858969243,1.227969530287 &
            ,-1.613685041513,-0.151570819852,0.205841480735,0.422661478025,0.255984911158,-0.069650314335,0.724773663398,0.516856844647,-0.593126124556,1.223261689402,-1.454630704028,-0.184622686553 &
            ,-0.728802910026,-0.263246074907,1.092851093499,-1.343281594137,-0.277887436791,-0.582969562170,-0.676892859740,-0.294572971200,-1.538242729218,-0.818683161895,3.072722639588,-1.935505585512 &
            ,-0.314679287905,-1.462681606181,0.506160968306,0.414558672518,0.091188168906,-0.363419029187,-0.435250471726,0.631803477937,0.081031524486,-0.349802842364,1.081407856709,-0.725019005922 &
            ,-1.126969847217,0.227686192026,-0.869764328541,-0.820140882391,-0.026845538045,-0.357961675611,0.222617055618,-0.623677702884,-1.035560176551,0.054942432506,-0.610882719412,-1.072750697030 &
            ,0.037194436233,-0.533719869665,-0.134567282977,-0.070005458321,-0.755196591825,-0.199590891715,0.320287094756,-1.108665826543,0.194710333232,0.581424163846,-0.446927514923,-0.417309085337 &
            ,0.030632505182,-0.167476371380,0.574703016960,-0.143431239638,-0.372906628040,0.512729562108,-0.346265881774,-0.237187683952,0.720618685270,-0.153243893649,0.688274393742,0.687709110747 &
            ,-0.240211207242,-0.317812316320,-0.343596797317,0.602164934779,0.475110358929,-0.087620676668,-0.230468130878,0.243521767245,-0.142167847805,-0.127830794652,0.070240753153,0.298235878390 &
            ,1.317794947062,-0.072783276131,0.049240095887,1.168729445110,0.375126833400,0.117473015494,0.645605798362,1.181746132299,1.845463854855,0.298535825884,-1.072082128691,1.944288248101 &
            ,0.622078380529,0.375394607470,-2.239293758915,1.452760709864,1.325684926020,-0.312853022673,0.530284512260,1.429466832816,0.356815242465,1.427433325946,-0.421859351836,0.222777633996 &
            ,0.081181298120,0.216807785323,0.994913452607,1.074765619908,-1.079094957306,-0.833013093785,-1.377487545197,0.951160854991,0.698156116644,0.228427812804,-1.847584447953,0.329468872042 &
            ,-1.894629684863,-0.287461196835,0.248050268553,0.026418402855,1.593721584620,-0.295549442233,0.314478402005,1.550245281409,0.065659584028,-0.905678061994,0.668956336279,0.039047862930 &
            ,0.816905477755,-0.035781355397,0.899481783289,0.572236547499,0.950011108064,-0.600406624615,1.533543723465,0.197233946090,1.655311696104,-0.269228602611,1.343025406699,1.079229662855 &
            ,0.166222196287,-1.818336227287,0.596775724410,-0.022924707181,0.124681946198,-0.046856222235,-2.151388942380,-1.139416820861,0.629135964657,-0.039036644089,1.595629944540,-1.500794998238 &
            ,-0.669662343681,-0.113128910785,-0.766650251905,0.020764168775,1.209555568673,0.696449676030,0.385761730422,0.296179136650,-0.916972516029,0.965632033444,-2.653088937148,-1.151576909280 &
            ,-0.264496513736,1.228731146707,0.629392215210,0.356834427826,-0.457975185266,0.352879081937,-0.751904742162,-1.128215945870,-0.964225654146,0.217847119429,0.468853518771,-0.159121087047 &
            ,-0.451882947444,0.413703915805,-1.241127902343,-0.620878592524,0.021542854810,-0.404971571813,0.028244394476,-0.126093795067,-0.046837898249,-0.073307200354,0.184463393019,-0.021111066330 &
            ,0.262266028633,0.353153681523,-0.223385812614,0.667090393712,0.431303181758,-0.058325640717,0.592325855109,0.001389777093,0.054452243171,0.102945238408,0.554324366048,-0.783284844247 &
            ,-0.179101294492,0.147583507577,-0.261018147718,0.319747351164,0.444544867442,0.326038919617,-0.127098209739,-0.386183811162,-0.925445324517,0.092304452830,-0.360770879940,-0.716134074513 &
            ,0.807925605963,0.544595545503,0.218377433944,-0.771060585071,-0.858461068334,-0.027235098956,0.395957112701,-0.787713616617,0.485151690888,0.152793534831,0.074053809534,-0.160543942784 &
            ,0.140071084790,-0.012854088628,-0.119444513802,0.188189025542,-0.664505768448,0.156996093059,0.983427400938,-0.543771149175,-0.096210415743,0.048998359566,0.018763078171,0.083282824379 &
            ,-0.539133437962,-0.042903454231,-0.218288642825,-0.536662205408,0.429507970564,-0.395300069922,1.379617070725,-0.949309231309,-0.539609422687,0.178013104697,0.148182159229,0.189953039041 &
            ,-0.792587029678,0.058974904659,1.032874841498,-0.227280093661,-0.265525902906,0.047170462561,-0.427063452951,0.165590945192,-0.565011485188,0.217921965229,0.520891299561,-0.351347457037 &
            ,-0.308069329077,-0.055968407880,-0.163652172812,-0.035618787065,0.113280038180,-0.056724495488,-0.238053689117,-0.859088999307,-0.177900402263,0.036863576550,0.774967899779,-0.091824521759 &
            ,-0.251861221675,0.031116179178,-0.730965697240,0.033629377641,0.314335020308,0.361660943129,1.508338720001,-0.206990204698,-0.029547337723,0.583075278383,-0.927377695889,0.115772506766 &
            ,0.285273490928,0.339103322040,1.399366325605,-0.215869616404,0.793240618958,0.601603290131,-0.582707474393,-0.443775822491,0.249692560186,0.180541912280,0.924616147329,0.245001671476 &
            ,-0.260017146697,0.776636006712,-0.424097749352,0.535282484354,0.506076842572,-0.012680016210,-0.650892535846,0.444829951920,-0.990670992123,1.610603965284,-0.495519411986,0.874390985781 &
            ,0.788306682291,-0.050587270063,-1.325430139371,0.848372430774,-1.790139159282,0.947606761779,0.058216907900,1.092756183990,0.636141104282,0.141905388060,-0.517714195242,0.675748520566 &
            ,-1.078893314759,0.139427792633,0.593522928743,0.756930994782,0.622867654885,0.176993179805,-0.416647203817,0.460277473372,-0.609879005966,1.020589696925,0.807710063367,0.402040261539 &
            ,0.591520747993,0.203085094864,-0.241780616312,0.392801268648,-0.421887747712,0.704372357471,0.799840440253,0.246890303423,0.565806650030,0.189553472433,-0.120507983037,0.378807946522 &
            ,-0.397402293944,0.115395167243,0.709438328837,0.195669253340,0.532710033978,0.160072455169,-0.053787420731,0.295168237912,-0.347949772102,-0.095777460782,0.687682709206,0.121572723267 &
            ,0.526039386959,0.119296917939,-0.089126231730,0.155039428267,-0.172708305648,0.441931462033,0.766173748359,-0.050348876462,0.542275186261,0.115418510282,-0.262283967994,-0.140687648308 &
            ,0.287909746532,1.215053329327,0.865185071298,-0.491784789633,0.469879524047,0.349333655986,-0.053218311618,-0.364196322695,0.695924736566,-1.239930700850,0.678902599400,-0.719132800484 &
            ,-0.155516726694,-0.762186787572,-1.500084591693,0.668053790430,2.429949198144,-0.595844513267,0.295956572897,-0.800264304640,-0.361233929825,-0.340849063752,0.662775323388,0.824668345979 &
            ,2.646378322866,0.033706844669,0.260919012915,-1.318500950262,-0.290649782253,-0.260815477714,1.318853691703,0.502720702847,1.407545901682,0.257698852564,-0.372071852953,-0.781463597321 &
            ,-0.118885427611,-0.309601468506,1.090221764360,0.344828415579,1.290414329222,0.042717468602,-0.775198124074,-1.229711409796,-0.235573446137,-0.115038518195,2.588417632414,-0.188431669050 &
            ,2.301987539984,0.858016912880,-0.109666749448,-2.201651072539,-1.120744361983,0.719136290489,3.659617437667,-0.712290913463,2.971329588971,1.429928495259,0.449110642744,-1.594711902904 &
            ,-1.003741053942,0.847316591750,2.765344818611,-0.146005718748,1.450299007172,1.629634112863,0.466514548412,0.040809189618,-0.589761460649,0.362832991342,1.857906128963,-0.322199734998 &
            ,1.405768307713,2.966358683815,0.361869485544,-0.223693645342,0.381811446972,-0.513721198472,1.526408510194,0.870550986357,0.315495321349,4.586190500121,0.437891379669,-0.171819077779 &
            ,0.872785843581,-0.685011661345,0.060474001537,0.284526126776,1.616194398475,10.534834267259,1.116920195378,-1.528666599070,0.676150948298,-0.781334234695,0.856333788328,0.515316030508 &
            ,0.180638957059,2.370823468133,0.087032432088,0.416519384269,0.617421597414,-0.844514562346,0.925594398602,0.564922870666,-0.054068993401,1.318700052076,-0.118790340286,0.695778232511 &
            ,0.575828925855,-0.879763735484,0.879084705669,0.616080423291,-0.182570539409,1.319303156462,-0.212151481196,0.779333432906,0.522531876437,-0.858801413919,0.935249648299,0.758272723236 &
            ,-0.337948207181,1.636253631662,-0.300589318020,0.830611376765,0.527124472239,-0.836219260773,0.996152337457,0.862197821661,-0.221026455829,2.662110460765,-0.221437611398,0.644899109251 &
            ,0.605022115583,-0.698442229622,0.916263368013,1.002698559718,-0.199758699206,3.442384911711,-0.153259761294,0.459173178708,0.610290370310,-0.237271443886,0.556214379881,1.071996491020 &
            ,-0.012699844551,3.267792336000,-0.025174097032,-0.012602610699,0.437009555252,0.671902908462,0.219822173284,0.809833598339,0.378701553141,-0.114670455710,0.179566889545,-0.477516752669 &
            ,1.197796288235,-0.273153077717,1.413181489804,-1.259902067333,-0.563960471851,0.402538983953,-2.025703961707,-0.245723766027,-1.200447504640,-0.976266845825,-0.755825190066,3.115498746282 &
            ,2.099018986281,-0.432418476039,1.613923637370,0.883474910617,-0.600878918506,0.222710876766,-0.976839662920,-1.794873097754,0.815268463406,-0.047405326370,-0.139479040822,2.704908547029 &
            ,0.024339276995,-0.377146326899,-0.005627784620,1.277132062133,1.195915612095,-0.121248042484,0.535410271578,0.183607395321,1.955403551932,0.248019035060,1.035271783304,-0.903573356972 &
            ,-2.288525251393,0.348520987190,-1.802858584132,-1.396853271432,-0.468500415479,-0.638997302108,0.765226348949,-0.599798644936,1.288425234609,0.054894179616,-0.160883738474,2.263774082061 &
            ,0.070738680456,0.025806417383,-0.420581586547,1.576911584014,0.496706942081,-0.277702261858,1.026831657206,-0.424713699697,-1.682678867806,-0.293011578408,-0.544592416086,0.458311744669 &
            ,0.397304829132,-0.163611906128,-0.463490650735,-0.230511853940,0.375518272194,-0.560205817034,0.107540747643,-0.274251196960,0.483780707795,-0.253240675149,-0.471596246309,1.079333083141 &
            ,0.909384551684,0.365673809697,0.643386074611,1.297888365560,-0.152026093761,-0.411275058801,-0.134028887734,-1.211530124456,0.926564946667,0.076457167735,-0.026605883074,-0.825853299040 &
            ,-0.490407612193,-0.148195887377,0.268704199533,0.231199285898,0.068656185732,-0.309264093969,-0.382037414000,-0.772987597975,0.222257923237,-0.254221924810,0.227980226730,0.354027532820 &
            ,-0.656356487683,-0.014006452983,0.585254845445,-0.035041166196,-0.016453716092,0.087565448652,-0.084314289865,-0.064347484022,-0.720640346203,0.067536611307,0.042871128945,0.093427840031 &
            ,0.334113577493,-0.037996429850,-0.170637950323,-0.142755863527,-0.554774241974,-0.831281059623,0.213306876950,-0.396870493774,0.354712047760,-0.098946412817,-0.466876419411,0.181729080349 &
            ,-0.066641917081,-1.141625854150,0.221092376942,1.187347611351,0.736041320125,-0.166882688717,-0.286545434850,-0.031633004872,-0.105236607358,-0.019970621982,-0.398286178169,1.095413295144 &
            ,0.048103349886,-0.143427735657,0.192716816820,-0.220737322934,0.372529897162,0.941326301448,-0.159880356528,-0.956263779018,-0.450855378017,0.133897955532,-0.387149088860,0.290869932556 &
            ,1.218655284202,0.125061770583,0.535696023128,-1.038731456368,-2.074079810620,0.011990855235,0.057121638984,-1.988463135434,-0.440300611180,0.737582874231,0.120987543152,-1.319606536973 &
            ,-1.388168717758,0.213762564829,-0.417804665331,-0.440538071916,-0.050458567718,-0.057829767402,0.161187860865,-0.211338310189,-0.821792530489,0.099751191105,-0.678155688072,-0.880553224607 &
            ,0.709099970777,0.440346139621,-0.226223485005,0.117603281945,-0.257811750251,-0.070304907044,0.502208064592,-0.631892380138,-0.211000272165,-0.182751233269,0.279541861851,0.808691710154 &
            ,0.239468124394,0.003046979333,0.191127976762,-0.339206160985,0.058527832218,0.373638523749,-0.091616437223,-0.553312528355,-0.723942327745,-0.021139430691,0.258961582490,-0.613300226666 &
            ,-0.042899670569,0.062240587322,-0.265791171846,-0.268682274544,-0.056193958002,-0.020877387726,-0.123970193123,0.258167559222,-0.118240424310,-0.016980130991,-0.191373528163,0.717648973792 &
            ,0.874936974524,-0.043394379810,0.115563359630,0.551424836639,-0.678668180944,0.188287883801,-0.746431809450,-0.345697818309,-0.715326633359,-0.109980691669,0.333626744198,-0.486113181271 &
            ,-0.026919545037,0.586048685327,0.204282666952,-0.725867031571,-1.065926578015,0.178889814021,-0.450819620416,-0.901517733740,0.002969516026,-0.184254985031,-0.055485922219,0.391176288266 &
            ,0.442194498714,-0.021094333809,-0.098734531444,0.301224076209,0.148834623714,0.079405851855,0.035133059860,0.017586833986,0.110253609382,0.027587721142,-0.139015912377,0.161030759173 &
            ,-0.024324716403,0.085047877461,-0.084415782598,0.253348887627,0.080513033047,-0.009039666035,0.165826980785,0.080537905004,0.067562720745,0.358761252731,0.035273477533,-0.316804436331 &
            ,-0.362768133137,0.047531299537,-0.084616353318,-0.321512780548,0.407402488745,0.532180341105,-0.001153464811,0.272182568546,-0.082874698011,0.053226053386,0.103266698774,-0.132038178515 &
            ,0.234439873814,0.351047979254,0.010115684167,0.073536536905,-0.332478657045,0.019803755451,0.066475749236,-0.398369407823,-0.016512772301,0.094137887084,0.017249736806,-0.005156153908 &
            ,0.186675814555,-0.017982938230,0.162730039186,0.249572571046,-0.030174618657,0.064610843867,-0.112399836673,-0.027741298201,-0.198291750994,-0.054023238023,0.232665909007,-0.196539238815 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/1.7171,2.5093 &
            ,-2.7347,-2.7796,4.8037,-2.4666 &
            ,1.1048,-4.2233 &
            ,2.6265,6.1865 &
            ,6.7285,13.0509 &
            ,3.6723,2.8147 &
            ,-0.21375,-4.9222 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/4.1249,-5.7204/),(/1,2/))
real, dimension(8) :: bias1 = &
  (/-0.60659,0.99237,-3.6963,1.4699,0.66998,-3.9498,-2.5649,2.2389/)
real, dimension(2) :: bias2 = &
  (/-2.6748,0.52484/)
real, dimension(1) :: bias3 = &
  (/1.6971/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 126
    inarray2(i) = inarray(127-i)
  end do
  layer1 = MatMul(input,inarray2)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
