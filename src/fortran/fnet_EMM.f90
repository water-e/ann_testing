module fnet_EMM

! a = 0.00016349
! b = 0.07116

intrinsic Reshape
real, dimension(8,126) :: input = &
  Reshape((/1.309039549510,0.482512382425,0.745344832003,0.032922027667,0.940893230385,0.746036105273,-1.696011537605,-0.837706619810,0.653860252287,-0.015648709293,-0.842893613993,1.841430592510 &
            ,-0.367065654501,-0.594109578662,-1.853939714450,0.321869527548,-1.769875066206,-0.594410270503,-0.351555543905,-2.408561944064,1.729627125478,-0.718827926922,1.850907156583,0.008114065135 &
            ,-0.173049485308,0.369371979874,1.195391011553,-0.714166573056,-0.372840031596,0.989464566804,3.882215823992,-0.710823378207,0.128975442205,-0.853260752962,-0.921801880239,0.778622558418 &
            ,0.681788731481,-1.120846450527,-4.410916207621,0.429300986265,-0.452341915904,-0.405214813976,-0.045820301186,-0.405649852977,-1.064121265304,0.115720667260,0.569083740649,1.207100198174 &
            ,-0.872623328383,0.138853171588,0.633121707996,-2.497040860109,-0.470331899576,0.451174353743,-1.516494955949,0.429495779422,-1.106458083472,-0.955935666302,-0.799273038861,-0.981119738803 &
            ,2.581924761960,-1.446719013555,0.806135434454,-0.495141197302,1.159857457253,0.802076046503,0.270821775127,1.371012921218,-0.645664942367,0.927026674077,1.153310940183,0.270688015987 &
            ,0.759600581648,0.505919476718,-0.366030648286,0.939635012111,0.174516334683,-0.660321561941,1.350332565564,-0.853478942191,-0.672734912421,0.266104172775,0.486202546035,-0.385336620727 &
            ,-0.624809462928,1.631436259799,3.504460004765,0.515787974947,1.225327775019,-0.985201978282,0.248878451580,0.705875925011,-0.490182194860,-1.059442765750,5.084350178261,1.119344047156 &
            ,-0.765718743488,-0.470222025950,-0.104550259823,-1.077129057374,-0.891310092049,-0.295274707958,-1.704899194101,1.176402839194,0.421429379624,-0.142222244169,-0.306071604616,0.816907637611 &
            ,-0.114771796595,-0.337760295250,-1.244161727267,0.323471518891,0.218500362021,-0.537908596262,0.808616246949,-1.552777093027,-0.513857001720,-0.588981143490,-3.333092234109,0.190159500026 &
            ,-0.285897863710,0.004353168659,0.360387228041,-0.943560829808,1.392521891390,0.295700437267,-0.377913162416,-0.760419266256,-0.307692962809,0.803478426091,-0.167255685819,0.642212538298 &
            ,0.076132494411,1.113003702280,0.421994919386,-0.636331276532,-0.335728109325,0.867552394460,-0.864193772143,0.540921134851,-1.240101136676,-0.884921553764,-1.027747488707,-0.468903292507 &
            ,1.285791732516,0.294753544897,0.435219775408,0.214115131141,2.266219938146,0.832188330474,-0.650910491771,-0.601141222270,-1.091236154322,1.111465424366,-1.098829111948,-0.131469399626 &
            ,-2.928015773846,-1.242573254901,1.014188008861,0.294736400999,0.580882644726,-0.477266031937,-0.107700368651,0.153691493026,0.935276809425,0.265926816604,-0.610055460456,1.396922904102 &
            ,-0.397246899147,0.116419948519,1.198193051852,-1.605405679890,1.225066030077,1.595313668950,-3.747649539133,-1.164904019928,0.404075031565,1.546536697294,-0.221847076230,0.228465560310 &
            ,1.146179647114,0.160218828373,-3.659040954108,-1.942986010738,1.199008491245,-0.415043411282,1.433541880420,-0.844300416516,-1.252688262569,1.278197057525,-0.327151828684,1.339336470761 &
            ,0.708828311597,-0.593591201007,-0.787965389757,0.535104884535,1.118086155401,-1.002997471182,-0.874385526987,0.716652291393,-1.447868011787,1.335355727356,0.154858443004,0.565350391918 &
            ,-0.281947047560,3.608682585354,4.194370864055,0.407466025042,2.152971749898,3.951435103522,0.936141868719,2.798466187368,-4.697056677813,3.426109669264,2.346249492244,-1.229138422638 &
            ,-0.290318763435,-2.983062516441,-0.687352766209,-2.535415467357,1.350911022462,-4.621975311760,-3.544611530435,0.609522870408,0.556684967868,0.140051089237,-0.034487376179,1.025677863933 &
            ,-0.698947406189,-0.100735248763,0.073523421207,-0.392451446760,-0.160763222923,-0.274119517918,-0.432523377321,0.707753802858,-1.262892558775,-0.647066582265,-0.202199135625,0.234612755201 &
            ,0.597908228266,1.276402937367,0.238467489185,-0.475384008161,-1.535864293028,-0.274018704932,-0.857625919017,-0.762213189563,0.363511510271,-1.410961086127,-0.924795273212,1.807053407519 &
            ,0.537635985317,-1.010997582591,0.717678091340,1.144969349217,0.174497105175,0.619016128976,-0.204384275675,1.180983313977,0.518924815065,0.322330399164,0.214624165222,-1.445553644629 &
            ,-0.348097588832,0.461378882394,0.451150051698,-0.478387782527,-0.305039177619,0.869997676675,-0.293041563798,-0.604921085467,-1.006901009728,-1.861831920420,-0.027006393129,-1.605948053275 &
            ,-0.061563118352,-0.787548877573,1.224845652424,2.103704765938,-1.786211357812,-1.247949036545,-0.295254197283,-2.549500776821,0.135557145999,-0.939179982854,-0.855790196906,1.501730205943 &
            ,1.650585393308,1.751997756784,1.102710446302,0.600967695260,0.050486991026,-0.088837129322,1.076803677126,-3.111536460382,0.067286237130,0.883327866955,-0.942988978298,2.222837745632 &
            ,-2.113031539163,-1.733078070993,3.625979647708,-0.944200931223,-0.566935190143,-0.293445879155,1.792480374963,-2.493093584698,0.137864628168,-0.390452601493,3.329696997246,-1.791011016839 &
            ,-2.268804625692,-0.728439731755,-1.865022053608,1.273491392662,-1.781557605742,-1.823496260380,1.455213323660,-0.076570381254,0.161835884114,-0.504636645304,1.532854433051,-1.878251218299 &
            ,-0.127184862638,1.383626128720,1.570622648752,1.352888536177,-1.241140589521,-2.297428070314,-0.348849802093,-1.213601615041,2.454137801586,0.833343893352,-1.762470797295,2.520777409721 &
            ,3.142886748264,-1.562137297582,1.932406703268,-1.898688151610,4.076378340254,-1.093428581128,-0.371008666230,-0.294425150706,2.358992402770,-0.753915822726,-1.438256371363,2.495116124971 &
            ,-0.230316228367,-3.158512212296,0.149451224906,0.529212698358,0.903175873787,0.765132153590,1.601873073472,-0.490888326534,2.023045190256,1.870342804120,1.011247300812,-1.504828126266 &
            ,-1.645611101622,1.488593122005,-1.976316831959,2.694574899306,0.578478900116,0.367645393878,-2.244761428926,-2.450498904036,0.470733345570,-0.428973733490,0.236225183850,-0.272050041759 &
            ,-0.150403532877,-0.407109186569,-0.286744690732,0.790860859185,-0.451782431092,0.090211171315,-0.390002618179,0.753835014689,0.540474002434,0.042667844903,-1.595857294172,-1.002153454827 &
            ,-0.186753837746,0.482429373145,0.354932229410,-0.395693439355,0.213949290794,0.772103715896,2.039722236631,-0.213260942126,-0.119599159709,0.321814508966,-0.252983765327,0.148752101571 &
            ,0.267041678185,0.658900392653,-0.444063446241,0.377655540244,0.112539222783,0.405946333792,0.174994820700,0.355498689223,-0.570723669084,0.410794091767,-1.096919830076,-0.483871086911 &
            ,0.147304715386,-0.066903676481,-0.304295475083,0.555965160027,-0.067214711623,0.114804647169,1.964686903088,0.654856799306,-0.649819865358,-1.205002535919,-0.412780706830,-0.162671816515 &
            ,0.129048659793,-0.662265461402,1.019118493060,1.175501889187,0.952643024542,0.978411522594,0.143190820283,0.388424096446,0.024740406666,0.835369437728,-1.135248073458,-0.334115383188 &
            ,3.983519645948,-2.329241382852,-0.016990203103,4.301538069657,2.823917986422,-0.486177739207,-2.146339208358,0.710782968110,-1.704198974013,1.258735309759,-2.626411987283,0.633678255339 &
            ,-2.026664630882,-1.001106932734,-1.452625092346,2.640507830296,-5.390569421338,0.582687807934,-0.366441230146,-7.211803970101,2.759387996432,-1.409264784297,0.020067279905,-2.972271742022 &
            ,1.231781421903,-4.636616642818,3.712067904763,-1.469416123465,0.863942425163,-3.247651832588,-0.126882364994,-3.525135795501,0.191271534543,-1.323079283743,-0.727899281000,0.085001577087 &
            ,1.796270920660,-1.079788451122,1.655575450498,2.697899435077,-3.048535899788,-1.374533773658,-1.206678213936,1.464712296457,3.045427652473,1.516714554070,0.111456509611,-0.297973061429 &
            ,3.585027623486,2.174988511967,-0.711262964316,0.312965569892,5.306410264803,-0.073559063876,0.543568457822,-1.478846212247,2.040480474447,-0.407856589599,2.916355259501,-1.529026167511 &
            ,0.964522067147,1.393012593356,1.336149372111,1.138499731084,1.974440253542,-4.791198167676,5.393829641255,-0.466672887495,1.282409931871,0.999367984691,1.249969504926,-0.601510813352 &
            ,0.420240000072,1.389429022999,2.062965583543,-3.520769378528,-0.843099349429,-0.432655225393,0.971273415216,1.496999379993,0.454284221411,0.138335363705,0.005460402428,-1.731918303119 &
            ,-0.419256498277,-0.432983157944,0.549885873689,2.136260248723,-0.640267156302,-0.150676874243,0.863300987660,-0.791457326184,-0.456568037952,-0.826572769723,0.466673590763,2.168361579198 &
            ,-0.415184824610,-0.780179006990,-0.975219911045,-1.571776677134,-1.265966798541,-0.060425395224,0.383149937518,1.360125995096,-0.853685208623,-0.262238859603,0.173699059546,-1.543834272321 &
            ,-1.192496555582,-0.434921072229,0.072537785129,1.769618290639,-1.459309893116,-0.151665125768,1.810477480823,-0.797507265792,-1.083370054154,-0.753049038271,-0.258879958505,1.768955366059 &
            ,-0.973907848939,-0.741963049685,0.221435704682,-0.826005066901,-1.636917952362,-0.167235534232,-0.319754708510,0.746731277194,-0.157534282069,0.358757132730,-0.090814570661,-0.700647675142 &
            ,-1.410493894496,0.131368429699,-0.168122672314,1.058854693530,2.053678816804,1.123544386931,0.595160307053,-1.153844845249,-1.138198378270,1.884906238925,0.333725593261,1.883582856077 &
            ,-0.911138395632,2.668707397022,-1.375395260775,-0.643874823972,-1.209514162802,1.129670313260,-0.652335213793,0.760559671903,-0.514385135340,-0.585440193902,1.405612221304,0.184723474199 &
            ,1.378405542370,2.955850854589,-1.940439687538,-0.583601735610,2.094150729380,-1.178122876288,-0.437003844772,3.878882596278,-0.064976616086,-0.647878872527,1.601195037390,1.528620523650 &
            ,2.171883927248,-0.580833701587,-2.779974125057,2.611385128049,1.309024377784,-3.685971261051,0.064575836843,2.757048658736,-3.296621849844,-6.768348598413,4.075176363765,0.703407172024 &
            ,-2.390682589573,-1.111918107347,-0.311713241561,-1.435956691443,-0.065990132193,-1.300356934169,-2.344491996952,2.324272498011,2.567673030248,-3.039100542571,-1.152022614924,-0.149095797198 &
            ,-1.078993191485,-2.688034329540,2.081990774598,1.825818751386,1.567022322168,-0.023810716065,-0.072599609130,0.314559228956,-1.565023893272,-4.209632808898,-0.765066622577,3.221926823396 &
            ,3.907096021271,-3.225191441253,-0.320802105888,1.614598078431,-0.073754426340,-2.915325652294,1.828120349831,2.138887938681,2.407220754484,-1.174165056458,-1.307127583480,3.472070252799 &
            ,0.561023996157,1.233797131559,9.377445454297,0.331559907251,1.847735151522,0.679809497485,-1.771334379527,0.710006188453,-0.473165844869,2.621463031083,1.407370944965,-1.680649855034 &
            ,-1.218456718317,-0.340176560687,-1.127267018545,-0.314809514228,-0.455364825991,1.797037345068,-0.047463213098,-0.069105788124,0.540889382861,-1.007946024215,-0.782706574004,-0.072066240182 &
            ,0.445612718530,3.426510910541,-1.117123015868,-1.068591621528,0.875838820227,-0.668881755640,-1.898643850815,0.625547780033,-1.589306052151,0.224564657301,2.143024157158,-1.503941357512 &
            ,0.574081340621,0.740825759122,-1.898881178606,-1.382802220773,-0.318487219615,0.574538797182,3.023423687113,-1.958140096644,-1.100465623510,1.305360919674,-1.649725374454,-0.239330439460 &
            ,-1.498766488334,0.909928167622,0.713395639769,-0.760377477930,-0.334903926853,-2.399457782005,-1.917337985137,-1.818277161313,3.031354612738,1.136095156875,3.636414833266,-1.480612461567 &
            ,1.258993320215,-1.633835059263,-1.086473884793,-3.175874754153,0.210641356149,-1.933232966447,3.631561634442,0.310166633036,0.578664702479,1.756491209642,-0.445960197409,-1.846411025412 &
            ,-0.815483863055,0.330702426641,0.265079415986,-0.061087158014,-0.258921693850,0.957004075134,-0.423167426369,-0.785008756394,0.721681399667,0.041254423363,-0.093398200261,0.318521441006 &
            ,-0.964834168775,-0.905958217636,0.783649009067,0.399442737623,-0.115788179930,0.732084297210,-0.155864345716,0.581175984318,-0.470158194117,0.336519375943,0.476341519997,-0.704083460334 &
            ,-0.541505307458,-0.182556082762,0.166577755221,-0.449234407934,-0.146476562449,0.372847817243,-0.227927565190,0.072741150424,0.708769905884,-0.496488722867,0.348535824824,-2.170744787601 &
            ,0.678890263484,-0.836998219361,-1.754931044408,1.261611020244,-0.556679428719,0.871465572978,-0.108055850366,0.340836474053,-0.385062976347,0.955888318430,-1.199609670586,-0.763704971661 &
            ,0.156963602015,-0.002870046313,0.233113842898,-0.178591609734,0.097539007718,0.349940800482,1.423742335547,-0.097626026977,0.522397364090,-0.202607098774,0.313174500364,-0.913423562153 &
            ,-1.139540335022,-0.575609973382,0.431321613281,0.831401125773,-0.391826909449,0.363371672151,-0.445919214910,-0.392917035442,0.604016589187,-0.112004844119,1.286357712714,-0.480136878752 &
            ,-0.382512688013,0.220010495756,-0.504998559611,0.590265817690,-0.044122088231,1.043417518887,1.089012138380,-0.519575430147,0.068615586571,-0.510435807720,-0.068117468672,0.018154969745 &
            ,-0.385583450878,-0.072328854484,-1.411728692360,0.650662696314,0.256834195868,-0.446492400816,-0.161331331644,0.290118368835,0.496247582836,-0.214196734048,1.423365071816,0.353083938960 &
            ,-0.143059054544,-0.005267897713,0.068586364016,-0.134353027052,-0.492333361844,-0.101974973400,-0.241965062362,-0.176180602363,0.215393071525,-0.050258140426,-0.021945301595,0.242565152017 &
            ,-0.277540272356,-0.111032472289,0.727186972968,0.040272837883,-0.088773751077,0.434668750186,-0.027511298504,0.329493619669,-0.986063014647,0.113479314856,-1.956377465651,-0.506162170701 &
            ,-0.153946943195,0.733198442726,-0.004104946992,-0.018529757567,0.467006503118,0.498099250769,-0.984696694738,-1.140269484370,0.194636643038,-0.148135390420,-0.346946849035,0.454802675885 &
            ,0.692009164619,-0.101208093926,1.864888740988,0.250236714019,0.030226194044,0.054254184653,-0.134983229164,-0.062966818229,-0.301536753121,-0.390972883921,-0.845822875097,-0.006034755052 &
            ,0.182569698014,0.053060906352,-0.091899941799,0.223094280828,-0.022052388978,0.019929183967,-1.334462243430,0.042752297803,0.103483014645,-0.080944480042,0.117008495771,-0.149857099273 &
            ,0.073458827607,-0.162513226772,-0.140135133292,-0.119506851934,-0.347582576021,-0.103016902928,-0.026922966522,-0.347371127659,-0.141553554380,0.026058359153,0.605573011673,0.305748216234 &
            ,0.203184811736,-0.061417034324,-0.009272015390,0.238080532219,0.241625653312,-0.117336617977,1.181590554742,-0.076669634605,0.036932424558,0.224227854005,0.015088219217,0.097185498058 &
            ,-0.342693969404,0.233001725060,-1.540809092224,-0.063806432228,-0.105467802719,-0.139069778786,-0.156441250106,-0.152736476325,0.221533189278,-0.153254358661,-1.929482781708,0.041612105937 &
            ,0.082690726819,0.160302644077,0.075179421812,0.098203637671,-0.189100690271,0.156831621591,-0.792161698406,-0.150714108534,0.178172386970,-0.064986965031,0.048219749493,0.129234901263 &
            ,0.020185233074,0.055226734952,-0.529819670791,0.074201067462,0.071134971100,-0.062869223096,-0.059839238297,0.077256855123,-0.107113250037,-0.097770081018,0.147089786608,0.162440153680 &
            ,0.124782744736,-0.021977576410,0.022280832621,-0.050264152098,0.186906992946,-0.111639609134,-0.382533852195,-0.064248520142,-0.024662065994,-0.055567143044,0.032371472413,-0.184634760104 &
            ,0.051010924646,0.039512498402,0.193276688408,0.189038762717,-0.079778225667,0.031511679195,-0.012500055751,0.007224416997,-0.135938952650,0.036683603694,-0.038229287330,0.003037014079 &
            ,0.018066366504,0.042297230096,-0.005460380052,0.089848986458,-0.147763094312,-0.003690931627,0.143112389776,-0.027269789699,0.121670172576,-0.038592638105,-0.034953569257,0.089626875797 &
            ,-0.074316406067,-0.136487227480,-0.512021136735,0.009910863241,0.037757599338,-0.036267832641,0.053734156376,-0.050292555242,0.181227688893,0.056871689594,0.066353505337,-0.035363846622 &
            ,-0.068545795921,0.025968938344,0.031778969185,-0.080551473512,-0.086379468372,0.081222695680,0.354226138740,0.042129818862,-0.048825012853,-0.150657847273,-0.124583465278,-0.010139085520 &
            ,0.214649030529,-0.082945203446,0.266910136549,0.195186349176,-0.026551977086,-0.021463199953,-0.029331662489,-0.001522337064,0.037804771235,-0.003541746705,0.667565013601,0.059230592361 &
            /),(/8,126/))
real, dimension(2,8) :: hidden1 = &
  Reshape((/-9.7107,-0.44468 &
            ,11.0424,-3.0086,15.0812,-3.7788 &
            ,6.7912,-0.33903 &
            ,5.3942,0.37978 &
            ,-8.1149,3.3439 &
            ,-0.81991,0.4273 &
            ,7.821,-0.14365 &
            /),(/2,8/))
real, dimension(1,2) :: hidden2 = &
  Reshape((/-4.6192,0.49614/),(/1,2/))
real, dimension(8) :: bias1 = &
  (/-0.88129,2.3083,-4.8293,2.3985,-2.8295,2.3892,2.9864,-2.0715/)
real, dimension(2) :: bias2 = &
  (/-5.0172,-1.9597/)
real, dimension(1) :: bias3 = &
  (/4.72/)
contains
subroutine fnet_EMM_initall()
end subroutine fnet_EMM_initall
subroutine fnet_EMM_engine(inarray, outarray, init)
  intrinsic MatMul, Size
  real, dimension(:), intent(in) :: inarray
  real, dimension(:), intent(inout) :: outarray
  real, dimension(126) :: inarray2
  real (kind=8), dimension(8) :: layer1
  real (kind=8), dimension(2) :: layer2
  real (kind=8), dimension(1) :: layer3
  integer , intent(inout) :: init
  integer :: i, j
  do i = 1, 126
    inarray2(i) = inarray(127-i)
  end do
  layer1 = MatMul(input,inarray2)
  layer1 = layer1 + bias1
  do i = 1, Size(layer1,1)
    layer1(i) = 1.0 / (1.0 + DEXP(-1.0 * layer1(i)))
  end do
  layer2 = MatMul(hidden1,layer1)
  layer2 = layer2 + bias2
  do i = 1, Size(layer2,1)
    layer2(i) = 1.0 / (1.0 + DEXP(-1.0 * layer2(i)))
  end do
  layer3 = MatMul(hidden2,layer2)
  layer3 = layer3 + bias3
  outarray(1) = layer3(1)
end subroutine fnet_EMM_engine
end module fnet_EMM
